---
import Layout from "../layouts/Layout.astro";
import { getCldImageUrl } from "astro-cloudinary/helpers";
import ButtonClick from "../components/buttonClick.astro";
import { TOPICS } from "../models/topics";
const { searchParams } = Astro.url;
const id = searchParams.get("id");

if (id == null) return Astro.redirect("/");
type TopicKey = keyof typeof TOPICS;
const url = getCldImageUrl({ src: id });
---

<Layout title="no se xd">
  <div class="w-full flex justify-center" data-id={id}>
    <div class="flex flex-col p-5" >
      {(Object.keys(TOPICS) as TopicKey[]).map((key) => (
        <ButtonClick topic={key} icon={TOPICS[key].icon}>
          {TOPICS[key].name}
        </ButtonClick>
      ))}

    </div>
    <div class="h-[600px]">
      <two-up class="rounded-lg overflow-hidden">
        <img id="original" class="w-full" src={url} />
        <img id="preview" class="w-full" src={url} />
      </two-up>
      <small class="text-gray-400">{url}</small>
    </div>
  </div>
</Layout>
<script>
  import { getCldImageUrl } from "astro-cloudinary/helpers";
  import { TOPICS } from "../models/topics";
  import "two-up-element";

  const id = document.querySelector("div")?.getAttribute("data-id") ?? "";
  const preview = document.getElementById("preview") as HTMLImageElement;
  console.log(id);
  const button = document.querySelectorAll("button");

 

  const url = getCldImageUrl({ src: id });

  button.forEach((button) => {
    button.addEventListener("click", (e) => {
      const topic  = button.getAttribute("data-topic")
      if (topic == null || !(topic in TOPICS)) return;
      const select: keyof typeof TOPICS = topic as keyof typeof TOPICS;
      const url = getCldImageUrl({
        src: id,
        replaceBackground: TOPICS[select].description,
      });

      preview.style.opacity = ".3";

      preview.src = url;
      preview.onload = () => {
        preview.style.opacity = "1";
      };
    });
  });
</script>
